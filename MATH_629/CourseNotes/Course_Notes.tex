\documentclass{article}
\usepackage{amsmath, amsfonts}
\usepackage{enumerate}
\usepackage{subfig}
\input{notes_macros}
\setlength\parindent{0pt}
\setlength{\parskip}{\baselineskip}%
\begin{document}
\CPT{1}

\idf{1.1} \textbf{Survival analysis} is a collection of statistical procedures for data analysis for which the outcome variable of interest is time, $T$, until an event occurs.

\ir{1.1}
\bn
\im $T$ is a random variable with positive support. Examples are time until death, time until machine breaks, length of road travelled until have a flat tire, etc. We will use the phrases ``time until event'' and ``survival time'' interchangeably.
\im There are extensions and variations of survival analysis including \textbf{recurrent events} and \textbf{competing risks}.
\im Example of recurrent events - multiple hospitalizations. Example of competing risks - death on dialysis and receiving a kidney transplant.
\en

\idf{1.2} \textbf{Censoring} is when you have some, but not all, information about the time until event for some or all of your observations. There are three types of censoring.

We will only deal with right censored data in this course. This is the most common type of censoring.


\ir{1.2} We use the following notation
\bn
\item $T$ is the population random variable that represents time until event.
\item $t$ is the observed value of $T$.
\item $d$ is 0 or 1. If $d=0$ there is censoring and if $d=1$ an event (failure) occurred. $\delta$ is often used instead of $d$.
\en

\idf{1.3} The \textbf{survival function} gives the probability that the event will occur after a time $t$. That is,

\[
S(t) = P(T>t) \text{ for } t \in \mathbb{R}.
\]

Note: 1) The survival function always tends to 1 as t tends to infinity, i.e.,
\[
\lim_{t\rightarrow\infty} S(t) = 1
\]
and 2) for positive random variable $T$ we have $S(t) = 0$ for $t \le 0$.

\NTS Draw a smooth survival curve and draw a step function which is often used to estimate one (see page 10).

\idf{1.4} The \textbf{hazard function} is the instantaneous rate of change (i.e., the derivative) of the probability that the event will occur given that it has not occurred up to that time.
\[
h(t) = \lim_{\Delta \rightarrow 0} \frac{P(t \le T < t + \Delta | T \ge t)}{\Delta t}
\]
Note: 1) The hazard function is a rate not a probability, 2) the hazard can be any number from 0 to infinity, i.e, $0\ge h(t) \ge infty$, 3) the hazard depends on the unit of measurement of time. For example, all other things being equal, if time is measured in seconds as opposed to minutes then the hazard is increased by a factor of 60.

\ith{1.1} The hazard function and the survival function of a distribution have the following relationship

\[ S(t) = \exp\left[-\int_0^t h(u) du\right] \text{ and } h(t) = -\frac{d S(t)/dt}{S(t)}
\]
Proof:
\begin{align*} h(t) & = \lim_{\Delta \rightarrow 0} \frac{P(t \le T \le t + \Delta)} {P(T \ge t) \Delta t} \\
& = \frac{1}{S(t)} \lim_{\Delta \rightarrow 0} \frac{P(t \le T < t + \Delta)} {\Delta t} \\
& = \frac{(d/dt)F(t)}{S(t)} = -\frac{(d/dt)S(t)}{S(t)}.
\end{align*}
Now,
\begin{align*}
\exp\left[-\int_0^t h(u) du\right] & = \exp\left[-\int_0^t \left(-\frac{dS(u)/du}{S(u)} \right)du\right] \\
&= \exp\left[\ln (S(u)) |_0^t \right] = \exp\left[\ln(S(t)) - \ln(S(0))\right] \\
& = \exp\left[\ln(S(t))\right] = S(t).
\end{align*}

\ir{1.2} The first way of representing the data is how we will store our data in a data frame in R. The second way is a ``survival object'' that we create in R from the data frame. From the third way we will be able to estimate survival curves from each of our groups (RX=0 and RX=1). The fourth way is a generalization of the first way that allows for age at follow up (rather than time), time-dependent variables and recurrent events. Consider the third way:
\begin{enumerate}[ ]
\item The leftmost column $(t_{(f)})$ gives all of the times at which the event occurs for $f=1,\ldots,n$ plus $t_0$ at the start of the study.
\item The second column ($m_f$) gives the number of events that occur at each of the times.
\item The third column ($q_f$) gives the number of observations that were censored in time $[t_f,t_{f-1})$ for $f=2,\ldots,n$.
\item The last column $R(t_f)$ gives the number ``at risk'' at each time. For example, at time $t_{(1)}=6$, $m_{1}=3$ had the event, $q_{1}=1$ was censored in $[t_{(1)}=6, t_{(2)}=7)$ and
    \[
    R(2)=R(1)-m_{(1)}-q_{(1)}=21-3-1=17
    \]
     were ``at risk'' at time $t_{(2)}$.
\end{enumerate}
This way of presenting data, helps us estimate probabilities, at each time $t_{f}$ that a subject will ``survive'' beyond time $t_{(f)}$ (i.e. not have the event) have the event given that they have not have ``survived'' up until, but not including, time $t_{f}$. For example, at $t_{(2)}$ we estimate this probability as
\[ \dfrac{R(2)-m_2}{R{(2)}} = \dfrac{17-1}{17} = \dfrac{16}{17}
\]
This will allow us in chapter 2 to estimate overall survival probabilities at times $t_{(f)}, f=1,\ldots,n$ and thus estimate survival curves as step functions.

\idf{1.5}
\begin{enumerate}
\item The \textbf{average observed survival time }(ignoring censoring) is denoted by $\bar{T}$.
\item The \textbf{average hazard rate} is the total number of failures divided by the total observed survival time. It is denoted by $\bar{h}$.
\end{enumerate}
 For group 1 in the leukemia data we have
\[ \bar{T}_1 = \frac{6 + 6 + 6 + \ldots + 35}{21} \approx 17.1 \text { and } \bar{h}_1 \approx \frac{9}{6 + 6 + 6 + \ldots + 35} = .025
\]
For group 2 in the leukemia data we have
\[ \bar{T}_2 = \frac{1 + 1 + 1 + \ldots + 23}{21} \approx 8.6 \text { and } \bar{h}_2 = \frac{21}{1 + 1 + 1 + \ldots + 23} \approx .115
\]

Note for group 2, without censoring we have $\bar{h}_2 = 1/\bar{T}_2$. These are crude overall measures. If there was no censoring in group 1 and censoring in group 2 then $\bar{T}_1$ and $\bar{T}_2$ don't change and can be misleading. Instead, we want to estimate survival probabilities at particular times and for certain levels of covariates. That will be the subject of the rest of the book.





\CPT{2}

\CPT{3}

\ith{3.1} Let $LR_F$ be the value of the log-likelihood for a fitted Cox-Proportional Hazard model
\[ h(t;X) = h_0(t) \exp(\sum_i^p \hat{B}_iX_i) \].
Let $LR_R$ be the value of the log-likelihood for a fitted Cox-Proportional Hazard model
\[ h(t;X) = h_0(t) \exp(\sum_i^q \hat{B}_iX_i) \]
where $q<p$.
Then for a ``large sample'' we have the following approximate distribution
\[
-2(LR_R - LR_F) \sim \chi^2(p-q)
\]


\CPT{7}
\ir{7.1}
A \textbf{parametric survival model} is one is which the distribution is fully specified except the parameters. The Cox-Proportional Hazards model is \textbf{semi-parametric} because the baseline hazard is not fully specified. Parametric models assume the data follows a particular distribution and requires more assumptions for suitable estimation. Semi-parametric or non-parametric models require less assumptions (and thus are more robust) but yield less information.

\iex{7.1} The populations that you are modeling approximately follow the exponential distribution so that you assume
\[
S(t;X) = \exp(-\lambda t)
\]
where $\lambda$ depends on $X$.
Then one you estimate lambda you can plot survival curves and get estimated survival probabilities at any time.
So for $X=1$ you might have $\hat{\lambda=.5}$ and you can estimate
\[ S(2;1) \approx \exp(-.5 2)) = \exp(-1) = 0.36787
\]
\NTS \, Draw smooth survival curve and step function for Cox-Proportional Hazard.

\ir{7.2} We saw Proportional Hazards (PH) with respect to the Cox-Propotional Hazard Model.

\iex{7.2} We illustrate the Accelerated Failure Time property with an example. Let our survival random variable be time to death of 60 years olds, and $X$ be smoking status (0=non-smoker, 1=smoker).
Assume we have
\[
S(t;0) = S((2/3)t,1) \text{ for all } t>0
\]
Let $T_0$ be the survival random variable for non-smokers and $T_1$ be the survival random variable for smokers.

Then
\[ S(7.5;0) = P(T_0>7.5) = P(T_1>5;1) \]
 and
\[S(15;0) = P(T_0>15) = S(10;1) = P(T_1>10)
\]
Note we have
\[
S((3/2)t;0) = S(t;1) \text{ for all } t>0
\]
and $T_1=(3/2)T_0$.

\ir{7.3} In general, if we have the AT property for some $\gamma$ so that
\[ S(t;X) =  S(\gamma t;X^*)  \text{ for all } t>0, \text{ constant } \gamma > 0
\]
then
 \[ S((1/\gamma)t;X) =  S( t;X^*)  \text{ for all } t>0, \text{ constant } \gamma > 0.
\]
and if $T_X$ and $T_{X^*}$ are respective conditional random variables then
\[
\gamma T_X = T_{X^*}
\]

\ir{7.4} ``Failure'' odds are odds of event (failure) before time $t$ to event (failure) after time $t$. PO says failure odds for $X$ and $X^*$ are constant multiples of each other for all $t$. Example: We might have failure odds for smokers = 2 * failure odds for non-smokers for all $t>0$. Note that we have survival odds for smokers = (1/2) survival odds for non-smokers for all $t>0$.

\ir{7.5} Exponential accommodates PH. Why? Let
\[
\lambda=\exp(\beta_0 + \beta' X)
\] where $\beta, X$ are both $p \times 1$.
Then
\[
\text{HR}(X \text{ vs. } X^*)  = \dfrac{\exp(\beta_0 + \beta' X)}{\exp(\beta_0 + \beta' X^*)} = \exp(\beta'(X - X^*))
\]

\ir{7.6} Exponential accommodates AFT. Why? For any survival time $0 < q < 1$ solve
\begin{align*}
& q = S(t) = \exp(\lambda t) \\
& \ln(q) = - \lambda t \\
& t = \frac{1}{\lambda} (- \ln(q))
\end{align*}
Let
\[
\frac{1}{\lambda} = \exp(\alpha_0 + \alpha_1'X)
\]
Then we have $\exp(\alpha_0 + \alpha_1'X)$ (time to ``reach" $q$ for $X$) and \\ $\exp(\beta_0 + \beta'X^*)$ (time to ``reach'' $q$ for $X^*$). Thus,
\[
\gamma = \text{AF($X$ vs. $X^*$)} = \frac{\exp(\alpha_0 + \alpha_1'X)}{\exp(\beta_0 + \beta'X^*}) = \exp(\alpha_1'(X-X^*)).
\]

\ir{7.7} Relationship between AF and HR for exponential model. We have
\[
\lambda = \exp(\beta_0 + \beta_1'X) \text{ and } \frac{1}{\lambda} = \exp(\beta_0 + \beta_1'X) \\
\]
Thus,
\[ \ln(\lambda) = \beta_0 + \beta_1'X = -\alpha_0 - \alpha_1'X \implies \beta_i = -\alpha_i, \, i=0,1 \]
Thus,
\begin{align*}
&\theta = \text{HR}(X \text{ vs. } X^*) = \exp(\beta_1'(X - X^*)) =\\
&\exp(-\alpha_1'(X - X^*)) = 1/\text{AF}(X \text{ vs. } X^*) = 1/\gamma.
\end{align*}






\end{document} 